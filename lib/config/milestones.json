{
  "$schema": "./milestone-schema.json",
  "version": "3.0.0-mvp",
  "description": "7-milestone traffic light configuration based on analysis of 1,529 projects",
  "lastUpdated": "2025-01-10",
  "dataSource": "milestone-config-mvp-1760123323934.json",

  "milestones": [
    {
      "id": "intake",
      "name": "Intake",
      "order": 1,
      "icon": "📋",
      "color": "gray",
      "description": "Initial project audit and validation",

      "statusField": {
        "fieldId": 347,
        "fieldName": "Intake Status",
        "usage": "91%",
        "type": "status",
        "notes": "Primary status indicator"
      },

      "completionFields": {
        "primary": [
          {
            "fieldId": 461,
            "fieldName": "Intake Completed Date",
            "usage": "91%",
            "notes": "Main completion marker"
          }
        ],
        "backup": [
          {
            "fieldId": 1826,
            "fieldName": "Intake Checklist (HTML)",
            "usage": "100%",
            "notes": "Intake first pass HTML"
          },
          {
            "fieldId": 554,
            "fieldName": "Intake Complete URL",
            "usage": "100%",
            "notes": "Webhook completion flag"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 522,
            "fieldName": "Sales Date",
            "label": "Project Started",
            "usage": "100%",
            "order": 1
          },
          {
            "fieldId": 461,
            "fieldName": "Intake Completed Date",
            "label": "Approved",
            "usage": "91%",
            "order": 2
          }
        ]
      },

      "overdue": {
        "projectAgeThreshold": 7,
        "notes": "More than 7 days without intake completion"
      },

      "dependencies": [],

      "uiNotes": "Status triggered by Sales Date. Green when Intake Completed Date exists. Red if >7 days old."
    },

    {
      "id": "survey",
      "name": "Survey",
      "order": 2,
      "icon": "📐",
      "color": "blue",
      "description": "On-site data collection",

      "statusField": {
        "fieldId": 162,
        "fieldName": "Survey Status",
        "usage": "100%",
        "type": "status"
      },

      "completionFields": {
        "primary": [
          {
            "fieldId": 165,
            "fieldName": "Survey Approved Date",
            "usage": "varies",
            "notes": "Survey complete and approved"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 2526,
            "fieldName": "Arrivy Scheduled Date (Primary)",
            "label": "Scheduled",
            "usage": "HIGH",
            "order": 1,
            "notes": "Primary scheduling field"
          },
          {
            "fieldId": 166,
            "fieldName": "Survey Scheduled Date (Fallback)",
            "label": "Scheduled",
            "usage": "fallback",
            "order": 1,
            "notes": "Use if Arrivy not available"
          },
          {
            "fieldId": 164,
            "fieldName": "Survey Submitted Date",
            "label": "Submitted",
            "usage": "79%",
            "order": 2
          },
          {
            "fieldId": 165,
            "fieldName": "Survey Approved Date",
            "label": "Approved",
            "usage": "varies",
            "order": 3
          }
        ]
      },

      "overdue": {
        "projectAgeThreshold": 3,
        "notes": "> 3 days past Arrivy/scheduled date",
        "checkField": 2526
      },

      "dependencies": ["intake"],

      "uiNotes": "Blue when intakeCompletedDate exists. Yellow when scheduled/submitted. Green when approved. Red if >3 days overdue."
    },

    {
      "id": "design",
      "name": "Design",
      "order": 3,
      "icon": "🎨",
      "color": "purple",
      "description": "Design & Engineering",

      "statusField": {
        "fieldId": 317,
        "fieldName": "Design Status",
        "usage": "100%",
        "type": "status"
      },

      "completionFields": {
        "primary": [
          {
            "fieldId": 478,
            "fieldName": "Engineering Completed",
            "usage": "68%",
            "notes": "Engineering stamp complete triggers next milestone"
          }
        ],
        "backup": [
          {
            "fieldId": 315,
            "fieldName": "Design Completed",
            "usage": "68%"
          },
          {
            "fieldId": 476,
            "fieldName": "CAD Design Approved",
            "usage": "68%"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 315,
            "fieldName": "Design Completed",
            "label": "Design Complete",
            "usage": "68%",
            "order": 1
          },
          {
            "fieldId": 476,
            "fieldName": "CAD Design Approved",
            "label": "CAD Approved",
            "usage": "68%",
            "order": 2
          },
          {
            "fieldId": 478,
            "fieldName": "Engineering Completed",
            "label": "Engineering Complete",
            "usage": "68%",
            "order": 3
          }
        ]
      },

      "slaTracking": {
        "deadline": {
          "fieldId": 2459,
          "fieldName": "Design SLA Deadline",
          "usage": "25.2%",
          "urgentThreshold": 3,
          "unit": "days"
        }
      },

      "overdue": {
        "projectAgeThreshold": 21,
        "notes": "> 21 days since survey approved"
      },

      "dependencies": ["survey"],

      "uiNotes": "Blue when surveyApprovedDate exists. Yellow during design/CAD phases. Green when engineeringCompleted. Red if >21 days."
    },

    {
      "id": "permitting",
      "name": "Permitting",
      "order": 4,
      "icon": "📄",
      "color": "indigo",
      "description": "AHJ, NEM & HOA Permits",

      "statusField": {
        "fieldId": 2095,
        "fieldName": "Permit Status",
        "usage": "100%",
        "type": "status",
        "notes": "Primary permit status"
      },

      "completionFields": {
        "primary": [
          {
            "fieldId": 208,
            "fieldName": "AHJ Permit Approved",
            "usage": "59.1%",
            "notes": "Primary permit completion"
          },
          {
            "fieldId": 327,
            "fieldName": "NEM Approved",
            "usage": "54%",
            "notes": "NEM/Interconnection approval"
          }
        ],
        "optional": [
          {
            "fieldId": 213,
            "fieldName": "HOA Application Approved",
            "usage": "conditional",
            "notes": "Only required if HOA applies"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 1844,
            "fieldName": "NEM Signatures Sent",
            "label": "NEM Signatures Sent",
            "usage": "63.8%",
            "order": 1,
            "notes": "Customer signatures needed"
          },
          {
            "fieldId": 326,
            "fieldName": "NEM Submitted",
            "label": "NEM Submitted",
            "usage": "58.7%",
            "order": 2
          },
          {
            "fieldId": 327,
            "fieldName": "NEM Approved",
            "label": "NEM Approved",
            "usage": "54%",
            "order": 3
          },
          {
            "fieldId": 207,
            "fieldName": "AHJ Permit Submitted",
            "label": "Permit Submitted",
            "usage": "65%",
            "order": 4
          },
          {
            "fieldId": 208,
            "fieldName": "AHJ Permit Approved",
            "label": "Permit Approved",
            "usage": "59.1%",
            "order": 5
          }
        ],
        "hoa": [
          {
            "fieldId": 212,
            "fieldName": "HOA Application Submitted",
            "label": "HOA Submitted",
            "usage": "conditional",
            "order": 6
          },
          {
            "fieldId": 213,
            "fieldName": "HOA Application Approved",
            "label": "HOA Approved",
            "usage": "conditional",
            "order": 7
          }
        ]
      },

      "blockedState": {
        "condition": "nem_signatures_sent_7days_no_submit",
        "field": 1844,
        "threshold": 7,
        "unit": "days",
        "message": "Customer signatures needed - follow up!",
        "notes": "If signatures sent >7 days ago but not submitted, mark as blocked/red"
      },

      "helperFields": [
        {
          "fieldId": 2501,
          "fieldName": "Permit Dashboard Status",
          "usage": "16.8%",
          "type": "status"
        },
        {
          "fieldId": 328,
          "fieldName": "NEM Status",
          "usage": "100%",
          "type": "status"
        }
      ],

      "dependencies": ["design"],

      "uiNotes": "Blue when engineeringCompleted. Yellow when any permits submitted. Green when ALL required permits approved (NEM + Permit, +HOA if needed). Red if NEM signatures blocked >7 days."
    },

    {
      "id": "install",
      "name": "Installation",
      "order": 5,
      "icon": "🔧",
      "color": "green",
      "description": "System installation & electrical work",

      "completionFields": {
        "primary": [
          {
            "fieldId": 534,
            "fieldName": "Install Completed Date",
            "usage": "43%",
            "notes": "Primary install completion"
          }
        ]
      },

      "scheduledFields": {
        "primary": {
          "fieldId": 178,
          "fieldName": "Install Scheduled Start (PRIMARY)",
          "usage": "49.2%",
          "notes": "Primary scheduled date"
        },
        "estimated": {
          "fieldId": 1124,
          "fieldName": "Estimated Install Date",
          "usage": "97.1%",
          "notes": "Display if no actual scheduled date"
        }
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 178,
            "fieldName": "Install Scheduled Start",
            "label": "Scheduled",
            "usage": "49.2%",
            "order": 1
          },
          {
            "fieldId": 464,
            "fieldName": "Install Started Date",
            "label": "Started",
            "usage": "43.2%",
            "order": 2
          },
          {
            "fieldId": 534,
            "fieldName": "Install Completed Date",
            "label": "Completed",
            "usage": "43%",
            "order": 3
          }
        ]
      },

      "upcomingState": {
        "threshold": 7,
        "unit": "days",
        "checkField": 178,
        "notes": "Show 'upcoming' state if install within 7 days"
      },

      "overdue": {
        "threshold": 3,
        "unit": "days",
        "checkField": 178,
        "notes": "> 3 days past scheduled date"
      },

      "dependencies": ["permitting"],

      "uiNotes": "Blue when all permits approved. Yellow when scheduled/in-progress. Green when completed. Red if >3 days past scheduled."
    },

    {
      "id": "inspection",
      "name": "Inspection",
      "order": 6,
      "icon": "🔍",
      "color": "teal",
      "description": "Authority & utility inspections",

      "completionFields": {
        "primary": [
          {
            "fieldId": 491,
            "fieldName": "Inspection Passed Date",
            "usage": "25%",
            "notes": "Primary completion marker"
          }
        ],
        "backup": [
          {
            "fieldId": 1763,
            "fieldName": "Inspection Completed",
            "usage": "varies",
            "notes": "Alternative completion field"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 226,
            "fieldName": "Inspection Scheduled",
            "label": "Scheduled",
            "usage": "low",
            "order": 1
          },
          {
            "fieldId": 491,
            "fieldName": "Inspection Passed Date",
            "label": "Passed",
            "usage": "25%",
            "order": 2
          }
        ]
      },

      "helperFields": [
        {
          "fieldId": 571,
          "fieldName": "Inspection Pass/Fail Status",
          "usage": "varies",
          "type": "status"
        }
      ],

      "dependencies": ["install"],

      "uiNotes": "Blue when installCompleted. Yellow when scheduled. Green when passed. Red if failed."
    },

    {
      "id": "pto",
      "name": "PTO",
      "order": 7,
      "icon": "🎉",
      "color": "emerald",
      "description": "Permission to Operate",

      "statusField": {
        "fieldId": 556,
        "fieldName": "PTO Status",
        "usage": "100%",
        "type": "status"
      },

      "completionFields": {
        "primary": [
          {
            "fieldId": 538,
            "fieldName": "PTO Approved Date",
            "usage": "19%",
            "notes": "Final milestone completion!"
          }
        ]
      },

      "inProgressFields": {
        "substeps": [
          {
            "fieldId": 537,
            "fieldName": "PTO Submitted Date",
            "label": "Submitted",
            "usage": "low",
            "order": 1
          },
          {
            "fieldId": 538,
            "fieldName": "PTO Approved Date",
            "label": "Approved",
            "usage": "19%",
            "order": 2
          }
        ]
      },

      "celebration": {
        "trigger": "ptoApproved",
        "message": "🎉 PROJECT COMPLETE!",
        "notes": "Display celebration when PTO approved"
      },

      "overdue": {
        "threshold": 30,
        "unit": "days",
        "checkField": 537,
        "notes": "> 30 days since submission"
      },

      "dependencies": ["inspection"],

      "uiNotes": "Blue when inspectionPassed. Yellow when submitted. Green when approved with celebration! Red if >30 days overdue."
    }
  ],

  "fundingMilestones": {
    "description": "M1/M2/M3 milestone payment tracking",
    "dashboardFields": {
      "m1Status": {
        "fieldId": 2049,
        "fieldName": "Funding Dashboard: M1 Status",
        "usage": "100%"
      },
      "m2Status": {
        "fieldId": 2050,
        "fieldName": "Funding Dashboard: M2 Status",
        "usage": "100%"
      },
      "m3Status": {
        "fieldId": 2051,
        "fieldName": "Funding Dashboard: M3 Status",
        "usage": "100%"
      }
    }
  },

  "globalStatusFields": {
    "projectStatus": {
      "fieldId": 255,
      "fieldName": "Project Status",
      "usage": "100%",
      "values": ["Active", "Active - On Hold", "Completed", "Cancelled", "Active - PTO", "Active - Installed"]
    },
    "onHold": {
      "fieldId": 231,
      "fieldName": "On Hold?",
      "type": "checkbox"
    },
    "holdReason": {
      "fieldId": 232,
      "fieldName": "Hold Reason"
    },
    "blockReason": {
      "fieldId": 233,
      "fieldName": "Block Reason"
    }
  },

  "trafficLightColors": {
    "blue": {
      "name": "Ready",
      "description": "Ready to start - dependencies met",
      "condition": "Dependencies complete but not started",
      "cssClass": "bg-blue-500"
    },
    "yellow": {
      "name": "In Progress",
      "description": "Active work in progress",
      "condition": "Started but not complete",
      "cssClass": "bg-yellow-500"
    },
    "green": {
      "name": "Complete",
      "description": "Milestone completed",
      "condition": "Completion field has value",
      "cssClass": "bg-green-500"
    },
    "red": {
      "name": "Blocked/Overdue",
      "description": "Blocked or past deadline",
      "condition": "Blocked condition met OR overdue threshold exceeded",
      "cssClass": "bg-red-500"
    },
    "gray": {
      "name": "Pending",
      "description": "Waiting on dependencies",
      "condition": "Dependencies not yet met",
      "cssClass": "bg-gray-300"
    }
  },

  "engineConfiguration": {
    "priorityOrder": [
      "1. Check STATUS field first (100% usage where available)",
      "2. Check PRIMARY completion/date fields",
      "3. Fall back to BACKUP timestamp fields",
      "4. Fall back to CALCULATED or ESTIMATED fields",
      "5. Show 'Not Available' if all fields empty"
    ],
    "stateCalculation": {
      "complete": "PRIMARY completion field has value OR status='complete'",
      "in-progress": "Any in-progress field has value OR status='in-progress'",
      "ready-for": "Dependencies met AND not started (blue light)",
      "blocked": "Special logic (e.g. NEM signatures >7 days, project on hold)",
      "overdue": "In progress AND > threshold days past scheduled date (red light)",
      "pending": "Dependencies not met OR no field values (gray light)"
    }
  },

  "configurationNotes": [
    "⭐ 7-MILESTONE SYSTEM: Simplified from 10 to 7 milestones for clearer tracking",
    "⭐ PERMITTING MILESTONE: Combines HOA/NEM/Permit into one comprehensive tracking phase",
    "⭐ TRAFFIC LIGHT COLORS: Blue (Ready) → Yellow (In Progress) → Green (Complete) / Red (Blocked/Overdue) / Gray (Pending)",
    "⭐ DATA-DRIVEN: Field mappings based on analysis of 1,529 projects",
    "✅ HIGH USAGE FIELDS: Prioritizes fields with highest data coverage",
    "✅ SMART BLOCKING: NEM signatures >7 days triggers blocked state",
    "✅ CELEBRATION: PTO approval triggers completion celebration",
    "📊 BASED ON: milestone-config-mvp-1760123323934.json"
  ]
}

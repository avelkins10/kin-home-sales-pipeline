<!DOCTYPE html>
<html>
<head>
  <title>Trigger RepCard Sync</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px 0; background: #0070f3; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0051cc; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .status { margin: 20px 0; padding: 15px; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>RepCard Sync Trigger</h1>
  <p>This page will trigger a comprehensive RepCard sync (skipping attachments for speed).</p>
  
  <button id="triggerBtn" onclick="triggerSync()">Start Sync</button>
  
  <div id="status"></div>
  <div id="results"></div>

  <script>
    async function triggerSync() {
      const btn = document.getElementById('triggerBtn');
      const statusDiv = document.getElementById('status');
      const resultsDiv = document.getElementById('results');
      
      btn.disabled = true;
      btn.textContent = 'Syncing...';
      statusDiv.innerHTML = '<div class="status info">üîÑ Starting sync... This may take a few minutes.</div>';
      resultsDiv.innerHTML = '';
      
      try {
        const response = await fetch('/api/admin/repcard/comprehensive-sync?skipCustomerAttachments=true&skipAppointmentAttachments=true', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          statusDiv.innerHTML = '<div class="status success">‚úÖ Sync completed successfully!</div>';
          resultsDiv.innerHTML = `
            <h3>Results:</h3>
            <pre>${JSON.stringify(data.results, null, 2)}</pre>
            <p><strong>Next steps:</strong></p>
            <ul>
              <li>Go to <a href="/analytics">Analytics</a> and check the Leaderboards and Canvassing tabs</li>
              <li>Check the <a href="/">Dashboard</a> for RepCard Metrics card</li>
            </ul>
          `;
        } else {
          statusDiv.innerHTML = '<div class="status error">‚ùå Sync failed: ' + (data.error || data.message || 'Unknown error') + '</div>';
          resultsDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      } catch (error) {
        statusDiv.innerHTML = '<div class="status error">‚ùå Error: ' + error.message + '</div>';
        resultsDiv.innerHTML = `<pre>${error.stack || error}</pre>`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'Start Sync';
      }
    }
  </script>
</body>
</html>

